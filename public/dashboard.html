<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Dashboard — Kaart met locaties</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    #map { width: 100%; height: 90vh; }
    body { margin: 0; padding: 0; font-family: sans-serif; }
    header { padding: 0.5rem; background: #f4f4f4; display:flex; align-items:center; gap:1rem; }
    header h2 { margin: 0; font-size: 1rem; }
  </style>
</head>
<body>
  <header>
    <h2>Dashboard — gedeelde locaties</h2>
    <button id="refreshBtn">Ververs</button>
    <span id="count"></span>
  </header>

  <div id="map"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Init map
    const map = L.map('map').setView([52.3702, 4.8952], 5); // centrum Nederland als uitgangspunt

    // OpenStreetMap tiles (via leaflet)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    let markers = [];

    async function loadLocations() {
      try {
        const res = await fetch('/locations');
        const locs = await res.json();
        // verwijder oude markers
        markers.forEach(m => map.removeLayer(m));
        markers = [];

        locs.forEach(entry => {
          const m = L.marker([entry.latitude, entry.longitude])
            .addTo(map)
            .bindPopup(`<b>ID:</b> ${entry.id}<br><b>Tijd:</b> ${entry.timestamp}<br><b>Label:</b> ${entry.label || '-'}`);
          markers.push(m);
        });

        document.getElementById('count').textContent = `Aantal locaties: ${locs.length}`;

        if (locs.length > 0) {
          const group = new L.featureGroup(markers);
          map.fitBounds(group.getBounds().pad(0.2));
        }
      } catch (err) {
        console.error('Fout bij ophalen locaties', err);
      }
    }

    document.getElementById('refreshBtn').addEventListener('click', loadLocations);

    // laad direct
    loadLocations();

    // optioneel: auto-refresh iedere 10s
    // setInterval(loadLocations, 10000);
  </script>
</body>
</html>
